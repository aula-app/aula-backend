# the apache configuration file, tuned to running the application

<VirtualHost *:80>
	#ServerName www.example.com
	DocumentRoot "${PROJECT_PATH}/empty"

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	# If BE and FE are served from the same domain, CORS headers can be removed
	Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Credentials "true"
  Header set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Referer,Authorization,User-Agent"
  Header set Access-Control-Expose-Headers "Authorization,Content-Length,Content-Range,Content-Type,Referer,User-Agent"
  Header set Access-Control-Allow-Methods "GET,HEAD,OPTIONS,POST,PUT,PATCH,DELETE"

  <Directory />
    Require all denied
  </Directory>
  
  Alias /api "${PROJECT_PATH}/api"
  <Directory "${PROJECT_PATH}/api">
      Require all granted
      Options -Indexes
      AllowOverride None
  </Directory>

  Alias /files "${PROJECT_PATH}/files"
  <Directory "${PROJECT_PATH}/files">
      Require all granted
      Options -Indexes
      AllowOverride None
  </Directory>

  # @TODO: nikola - can we just delete these files?
  #   they answer to unauthorized curl GET requests
	<Files "${PROJECT_PATH}/api/vote_test.php">
		Deny from all
	</Files>
	<Files "${PROJECT_PATH}/api/comment_test.php">
		Deny from all
	</Files>
	<Files "${PROJECT_PATH}/api/message_test.php">
		Deny from all
	</Files>
	<Files "${PROJECT_PATH}/api/cron.php">
		Deny from all
	</Files>

</VirtualHost>
