<VirtualHost *:80>
	ServerName "${APACHE_SERVER_NAME}"
	DocumentRoot "${PROJECT_PATH}/errors"

  ErrorLogFormat "[%{uc}t] [%-m:%-l] [R:%L] [C:%{C}L] %7F: %E: %M"
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	# If BE and FE are served from the same domain, CORS headers can be removed
	Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Credentials "true"
  Header set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Referer,Authorization,User-Agent,Aula-Instance-Code,Aula-Frontend-Version"
  Header set Access-Control-Expose-Headers "Authorization,Content-Length,Content-Range,Content-Type,Referer,User-Agent"
  Header set Access-Control-Allow-Methods "GET,HEAD,OPTIONS,POST,PUT,PATCH,DELETE"

  # Handle 403 and 404 errors with error response body (we're serving API)
  ErrorDocument 404 /404.json
  ErrorDocument 403 /404.json
  <Files "/404.json">
    ForceType application/json
  </Files>
  # Redirect all 403 responses to 404
  RewriteEngine On
  RewriteCond %{ENV:REDIRECT_STATUS} 403
  RewriteRule ^ - [R=404,L]

  Alias /api/classes "${PROJECT_PATH}/api/classes"
  <Directory "${PROJECT_PATH}/api/classes">
    DirectorySlash Off
    Require all granted
    Options -Indexes
    AllowOverride None
  </Directory>
  Alias /api/controllers "${PROJECT_PATH}/api/controllers"
  <Directory "${PROJECT_PATH}/api/controllers">
    DirectorySlash Off
    Require all granted
    Options -Indexes
    AllowOverride None
  </Directory>

  Alias /api/files "${PROJECT_PATH}/files"
  <Directory "${PROJECT_PATH}/files">
    DirectorySlash Off
    Require all granted
    Options -Indexes
    AllowOverride None
  </Directory>

  # Accessing root "/" will return 404.json
  RedirectMatch 404 ^/$
</VirtualHost>

# vim: set ft=apache:
